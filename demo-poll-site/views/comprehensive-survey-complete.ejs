<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey Complete - Comprehensive Survey 2024</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .completion-container {
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            overflow: hidden;
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .completion-header {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .completion-header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .completion-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .celebration-icon {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #28a745;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }

        .content {
            padding: 40px;
        }

        .thank-you-message {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 25px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 30px;
        }

        .thank-you-message h2 {
            color: #155724;
            margin-bottom: 10px;
        }

        .thank-you-message p {
            color: #155724;
            line-height: 1.6;
        }

        .completion-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 8px;
        }

        .stat-card p {
            color: #666;
            font-weight: 600;
        }

        .journey-summary {
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }

        .journey-summary h3 {
            color: #007bff;
            margin-bottom: 15px;
        }

        .journey-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .journey-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: white;
            border-radius: 20px;
            border: 1px solid #ddd;
            font-size: 0.9em;
        }

        .journey-step.completed {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .step-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #28a745;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .security-report {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
        }

        .security-report h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .security-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .security-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 0.9em;
            text-align: center;
        }

        .security-item.passed {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .security-item.warning {
            border-color: #ffc107;
            background: #fff3cd;
            color: #856404;
        }

        .next-steps {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            margin: 30px -40px -40px -40px;
            text-align: center;
        }

        .next-steps h3 {
            margin-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: white;
            color: #667eea;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,255,255,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: white;
            color: #667eea;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confetti-fall 3s linear infinite;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .bot-score-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: <%= botScore > 100 ? 'rgba(220, 53, 69, 0.9)' : botScore > 50 ? 'rgba(255, 193, 7, 0.9)' : 'rgba(40, 167, 69, 0.9)' %>;
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .data-insights {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .data-insights h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .insight-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .insight-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .insight-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="bot-score-display">
        Bot Score: <%= Math.round(botScore) %><br>
        Status: <%= botScore > 100 ? 'Blocked' : 'Passed' %>
    </div>

    <div class="completion-container">
        <div class="celebration-icon">🎉</div>
        
        <div class="completion-header">
            <h1>🎊 Survey Complete!</h1>
            <p>Thank you for participating in our comprehensive market research</p>
        </div>

        <div class="content">
            <div class="thank-you-message">
                <h2>✅ Submission Successful</h2>
                <p>Your responses have been recorded and will help us improve our products and services. We appreciate the time you took to complete this comprehensive survey with all its advanced interactive elements.</p>
            </div>

            <div class="completion-stats">
                <div class="stat-card">
                    <h3><%= session?.steps?.length || 0 %></h3>
                    <p>Steps Completed</p>
                </div>
                <div class="stat-card">
                    <h3><%= Math.round((Date.now() - (session?.startTime || Date.now())) / 60000) %></h3>
                    <p>Minutes Spent</p>
                </div>
                <div class="stat-card">
                    <h3><%= session?.windowsOpened || 0 %></h3>
                    <p>Windows Opened</p>
                </div>
                <div class="stat-card">
                    <h3><%= session?.modalsShown || 0 %></h3>
                    <p>Modals Shown</p>
                </div>
            </div>

            <div class="journey-summary">
                <h3>🗺️ Your Survey Journey</h3>
                <p>You successfully navigated through our comprehensive survey experience:</p>
                <div class="journey-steps">
                    <div class="journey-step completed">
                        <div class="step-icon">1</div>
                        <span>Demographics</span>
                    </div>
                    <div class="journey-step completed">
                        <div class="step-icon">2</div>
                        <span>Preferences</span>
                    </div>
                    <div class="journey-step completed">
                        <div class="step-icon">3</div>
                        <span>Modal Feedback</span>
                    </div>
                    <div class="journey-step completed">
                        <div class="step-icon">4</div>
                        <span>Verification</span>
                    </div>
                    <div class="journey-step completed">
                        <div class="step-icon">5</div>
                        <span>Iframe Content</span>
                    </div>
                    <div class="journey-step completed">
                        <div class="step-icon">6</div>
                        <span>Final Submit</span>
                    </div>
                </div>
            </div>

            <div class="security-report">
                <h3>🛡️ Security & Anti-Bot Analysis</h3>
                <p>Our advanced protection systems analyzed your session:</p>
                <div class="security-items">
                    <div class="security-item <%= botScore < 30 ? 'passed' : 'warning' %>">
                        <strong>Fingerprinting</strong><br>
                        <%= botScore < 30 ? 'Human-like' : 'Suspicious' %>
                    </div>
                    <div class="security-item <%= botScore < 50 ? 'passed' : 'warning' %>">
                        <strong>Behavior Analysis</strong><br>
                        <%= botScore < 50 ? 'Natural' : 'Automated' %>
                    </div>
                    <div class="security-item passed">
                        <strong>CAPTCHA</strong><br>
                        Verified
                    </div>
                    <div class="security-item passed">
                        <strong>Timing Analysis</strong><br>
                        Human-like
                    </div>
                    <div class="security-item passed">
                        <strong>Honeypot Detection</strong><br>
                        Clean
                    </div>
                    <div class="security-item <%= botScore < 100 ? 'passed' : 'warning' %>">
                        <strong>Overall Score</strong><br>
                        <%= Math.round(botScore) %>/100
                    </div>
                </div>
            </div>

            <div class="data-insights">
                <h3>📊 Session Insights</h3>
                <div class="insights-grid">
                    <div class="insight-item">
                        <div class="insight-value"><%= sessionId.substring(0, 8) %>...</div>
                        <div class="insight-label">Session ID</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-value"><%= new Date().toLocaleDateString() %></div>
                        <div class="insight-label">Completion Date</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-value"><%= session?.redirectCount || 0 %></div>
                        <div class="insight-label">Page Redirects</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-value">6/6</div>
                        <div class="insight-label">Steps Completed</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-value"><%= session?.ip?.substring(0, 10) || 'Hidden' %>...</div>
                        <div class="insight-label">IP Address</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-value">Chrome</div>
                        <div class="insight-label">Browser</div>
                    </div>
                </div>
            </div>

            <div class="next-steps">
                <h3>🚀 What's Next?</h3>
                <p>Your comprehensive survey experience is complete. Explore our other demo features or learn more about our technology.</p>
                
                <div class="action-buttons">
                    <a href="/" class="btn btn-primary">
                        🏠 Return to Start
                    </a>
                    <a href="/api/survey-analytics" class="btn btn-secondary" target="_blank">
                        📊 View Analytics
                    </a>
                    <button class="btn btn-secondary" onclick="downloadCertificate()">
                        📜 Download Certificate
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Create confetti effect
        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }, i * 100);
            }
        }

        function downloadCertificate() {
            const certificate = `
Survey Completion Certificate

Comprehensive Market Research Survey 2024

This certifies that the user with session ID: <%= sessionId %>
has successfully completed the comprehensive survey experience
including all advanced interactive elements:

✅ Multi-step form progression
✅ Modal window interactions  
✅ New window verification
✅ Iframe embedded content
✅ CAPTCHA challenges
✅ Anti-bot protection bypass
✅ Advanced form validation

Completion Date: ${new Date().toLocaleDateString()}
Total Steps: 6/6
Bot Score: <%= Math.round(botScore) %>/100
Status: <%= botScore > 100 ? 'Blocked' : 'Passed' %>

This survey demonstrates real-world complexity and
advanced web automation challenges.

Generated by: Comprehensive Survey System 2024
            `;
            
            const blob = new Blob([certificate], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'survey-completion-certificate.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Start confetti effect
            createConfetti();
            
            // Additional confetti every 3 seconds for first 10 seconds
            setTimeout(() => createConfetti(), 3000);
            setTimeout(() => createConfetti(), 6000);
            
            // Track completion event
            fetch('/api/track-behavior', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    completionEvent: {
                        type: 'survey_completed',
                        timestamp: Date.now(),
                        sessionId: '<%= sessionId %>',
                        botScore: <%= botScore %>,
                        totalSteps: 6
                    }
                })
            }).catch(console.error);
        });

        // Easter egg - click celebration icon
        document.querySelector('.celebration-icon').addEventListener('click', function() {
            createConfetti();
            this.style.animation = 'bounce 0.5s ease-out';
            setTimeout(() => {
                this.style.animation = 'bounce 2s infinite';
            }, 500);
        });
    </script>
</body>
</html>